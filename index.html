<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>ä¸‰äººæ’é›·æ¸¸æˆ</title>
<style>
  body{
    background:#1f1f1f;
    color:#fff;
    font-family:Arial;
    text-align:center;
    padding:30px;
  }
  #grid{
    display:grid;
    grid-template:repeat(3,90px)/repeat(3,90px);
    gap:10px;
    margin:25px auto;
  }
  .cell{
    width:90px;height:90px;
    background:#444;
    border-radius:10px;
    cursor:pointer;
    font-size:30px;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .hidden{background:#444;}
  .revealed{background:#666;cursor:default;}
  #status{font-size:20px;margin-top:15px;}
  button{
    margin-top:20px;
    padding:10px 20px;
    font-size:16px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    position:relative;
    z-index:10;
  }
</style>
</head>
<body>

<h1>ğŸ’£ ä¸‰äººæ’é›·æ¸¸æˆ</h1>

<div id="grid"></div>
<div id="status"></div>
<button onclick="init()">é‡æ–°å¼€å§‹</button>

<audio id="clickSnd" src="https://actions.google.com/sounds/v1/ui/click.ogg"></audio>
<audio id="boomSnd" src="https://actions.google.com/sounds/v1/explosions/explosion.ogg"></audio>

<script>
const grid = document.getElementById("grid");
const status = document.getElementById("status");
const clickSnd = document.getElementById("clickSnd");
const boomSnd = document.getElementById("boomSnd");

let bombs = {};          // æ¯ä¸ªç©å®¶çš„ç‚¸å¼¹ä½ç½®
let alivePlayers = [1,2,3];
let currentPlayer = 1;
let stage = "place";    // place / play / end
let placedCount = 0;

function init(){
  grid.innerHTML="";
  bombs={};
  alivePlayers=[1,2,3];
  currentPlayer=1;
  placedCount=0;
  stage="place";
  status.textContent="æ”¾ç½®ç‚¸å¼¹ï¼šç©å®¶ 1";
  for(let i=0;i<9;i++){
    const cell=document.createElement("div");
    cell.className="cell hidden";
    cell.dataset.index=i;
    cell.onclick=()=>cellClick(cell);
    grid.appendChild(cell);
  }
}

function cellClick(cell){
  if(stage==="end") return;
  const idx=parseInt(cell.dataset.index);
  clickSnd.play();

  if(stage==="place"){
    if(bombs[currentPlayer]!==undefined){
      alert("ä½ å·²ç»æ”¾è¿‡ç‚¸å¼¹äº†ï¼");
      return;
    }
    bombs[currentPlayer]=idx;
    cell.textContent="ğŸ’£";
    cell.className="cell revealed";
    placedCount++;

    if(placedCount<3){
      currentPlayer++;
      status.textContent=æ”¾ç½®ç‚¸å¼¹ï¼šç©å®¶ ${currentPlayer};
    }else{
      // å¼€å§‹æ’é›·
      stage="play";
      currentPlayer=alivePlayers[0];
      status.textContent=æ’é›·é˜¶æ®µï¼šç©å®¶ ${currentPlayer};
      document.querySelectorAll(".cell").forEach(c=>{
        c.textContent="";
        c.className="cell hidden";
      });
    }
  }else if(stage==="play"){
    if(cell.classList.contains("revealed")) return;

    cell.className="cell revealed";

    // æ˜¯å¦è¸©é›·
    for(const p in bombs){
      if(bombs[p]===idx && parseInt(p)!==currentPlayer){
        cell.textContent="ğŸ’¥";
        boomSnd.play();
        status.textContent=ç©å®¶ ${currentPlayer} è§¦é›·ï¼å‡ºå±€ï¼;
        alivePlayers = alivePlayers.filter(x=>x!==currentPlayer);

        if(alivePlayers.length===1){
          status.textContent=ğŸ‰ ç©å®¶ ${alivePlayers[0]} è·èƒœï¼;
          stage="end";
          return;
        }
        nextPlayer();
        return;
      }
    }

    cell.textContent="âœ”";
    nextPlayer();
  }
}

function nextPlayer(){
  const idx = alivePlayers.indexOf(currentPlayer);
  currentPlayer = alivePlayers[(idx+1)%alivePlayers.length];
  status.textContent=æ’é›·é˜¶æ®µï¼šç©å®¶ ${currentPlayer};
}

init();
</script>

</body>
</html>
